version: '3.8'

networks:
  app-tier:
    driver: bridge

services:
  backend:
    image: backend:${NODE_ENV}
    build:
      context: .
      dockerfile: ./Dockerfile
      args:
        NODE_ENV: ${NODE_ENV}
    env_file:
      - env/.${NODE_ENV}.env
    container_name: backend-${NODE_ENV}
    ports:
      - ${API_PORT}:${API_PORT}
    volumes:
      - ./certs/:/certs:ro
    networks:
      - app-tier
    restart: always

  frontend:
    image: frontend:${NODE_ENV}
    build:
      context: ../flexible-pomodoro-front
      dockerfile: ./Dockerfile
      args:
        NODE_ENV: ${NODE_ENV}
    env_file:
      - ../flexible-pomodoro-front/env/.${NODE_ENV}.env
    container_name: frontend-${NODE_ENV}
    ports:
      - '80:80'
      - ${FRONT_PORT}:${FRONT_PORT}
    volumes:
      - ./certs/:/etc/nginx/certs
    networks:
      - flex-net
